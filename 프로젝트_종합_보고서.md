# 📊 Blinkit 수요 예측 프로젝트 종합 보고서

## 📋 목차
1. [목표 정의](#1-목표-정의-문제--목표)
2. [데이터 품질](#2-데이터-품질-데이터-불균형-설명력-등)
3. [모델링](#3-모델링-모델-선택--feature--성능)
4. [운영](#4-운영-ui-mlops-db-network-vf)
5. [현 상황까지의 Demo](#5-현-상황까지의-demo)

---

## 1. 목표 정의 (문제 + 목표)

### 🎯 비즈니스 문제

| 구분 | 내용 |
|------|------|
| **핵심 문제** | 온라인 쇼핑몰(Blinkit)의 재고 관리 비효율성 |
| **Pain Point 1** | 상품별 수요 변동에 따른 재고 과잉/부족 발생 |
| **Pain Point 2** | 마케팅 활동과 판매량 간의 관계 파악 부재 |
| **Pain Point 3** | 기상요인이 판매량에 미치는 영향 미반영 |
| **Pain Point 4** | 주간 단위 발주량 결정 시 데이터 기반 의사결정 미흡 |

### 🎯 프로젝트 목표

```
[1차 목표] 수요 예측 모델 구축
    └─ 상품별 주간 판매량 예측 (정확도 70% 이상 목표)

[2차 목표] 재고 관리 최적화
    └─ 주간 권장 주문량 산출 및 품절 위험도 분류

[3차 목표] 외부 요인 분석
    └─ 기상요인(기온, 강수량, 폭염/폭우)이 판매에 미치는 영향 분석

[4차 목표] 의사결정 지원 시스템
    └─ 마케팅/재고/판매/기상 데이터 통합 분석 대시보드
```

### 🎯 성공 지표 (KPI)

| 지표 | 목표값 | 현재 달성 |
|------|--------|----------|
| MAE (평균 절대 오차) | ≤ 2개 | ✅ 0.87~1.78개 |
| 예측 정확도 | ≥ 70% | ✅ 62~77% (평균 72.58%) |
| R² Score | ≥ 0.5 | 🟡 0.29~0.80 (상품별 편차) |
| 품절률 감소 | 20% 감소 | ⏳ 운영 후 측정 |

---

## 2. 데이터 품질 (데이터 불균형, 설명력 등)

### 📁 데이터 소스 현황

#### 기본 데이터 (7개)
| 파일명 | 레코드 수 | 주요 컬럼 | 용도 |
|--------|----------|----------|------|
| `blinkit_orders.csv` | 5,000 | order_id, order_date, customer_id | 주문 기본 정보 |
| `blinkit_order_items.csv` | 5,000 | order_id, product_id, quantity | 주문 상세 |
| `blinkit_products.csv` | 100 | product_id, category, brand | 상품 마스터 |
| `blinkit_customers.csv` | 1,000 | customer_id, segment, area | 고객 정보 |
| `blinkit_delivery_performance.csv` | 5,000 | order_id, delivery_time_minutes | 배송 성과 |
| `blinkit_customer_feedback.csv` | 5,000 | order_id, rating | 피드백 |
| `blinkit_inventory.csv` | 75,172 | product_id, date, stock_received | 재고 |
| `blinkit_marketing_performance.csv` | 5,400 | date, spend, clicks, roas | 마케팅 |

#### 기상 데이터 (신규 추가)
| 파일명 | 레코드 수 | 주요 컬럼 | 용도 |
|--------|----------|----------|------|
| `blinkit_with_weather.csv` | 5,002 | temp_max, temp_min, rain_pre, heatwave, heavy_rain | 일별 기상 정보 |
| `blinkit_weekly_product_weather.csv` | 4,986 | 주간_평균_최고기온, 주간_평균_강수량, 주간_폭염_일수 | 주간 기상 집계 |

### 📊 기상 데이터 컬럼 설명

| 컬럼명 | 설명 | 단위/범위 |
|--------|------|----------|
| `temp_max` / `주간_평균_최고기온` | 최고 기온 | °C |
| `temp_min` / `주간_평균_최저기온` | 최저 기온 | °C |
| `temp_range` / `주간_평균_일교차` | 일교차 | °C |
| `rain_pre` / `주간_평균_강수량` | 강수량 | mm |
| `heatwave` / `주간_폭염_일수` | 폭염 여부/일수 | 0/1 또는 일수 |
| `heavy_rain` / `주간_폭우_일수` | 폭우 여부/일수 | 0/1 또는 일수 |

### ⚠️ 데이터 품질 이슈

#### (1) 데이터 불균형
| 이슈 | 상세 내용 | 영향도 | 해결 방안 |
|------|----------|--------|----------|
| **시간적 불균형** | 일별 데이터 변동성 높음 | 🟡 중간 | 주별 집계로 노이즈 감소 |
| **상품별 불균형** | Top 10 상품이 거래의 상당 부분 차지 | 🟡 중간 | 상품별 개별 모델 구축 |
| **지역별 기상 편차** | 지역별 기온/강수량 차이 큼 | 🟡 중간 | 지역별 기상 매칭 |

#### (2) 날짜 형식 불일치
```
📌 문제: 재고 데이터 (DD-MM-YYYY) vs 주문 데이터 (YYYY-MM-DD HH:MM:SS)
📌 해결: dayfirst=True 옵션 및 형식 통일 변환 적용
```

#### (3) 결측치 현황
| 변수 | 결측 원인 | 처리 방법 |
|------|----------|-----------|
| Lag 변수 | 첫 행은 과거 데이터 없음 | `dropna()` |
| 마케팅 데이터 | 광고 미집행일 | 0으로 대체 |
| 재고 데이터 | 매칭 실패 | 0으로 대체 |
| 기상 데이터 | 일부 지역 누락 | 인근 지역 평균 대체 |

#### (4) 모델 설명력 (R² Score)
| 모델 단계 | R² Score | 해석 |
|----------|----------|------|
| 초기 RF 모델 | **0.05** | 설명력 5% (매우 낮음) |
| 고도화 RF 모델 | **0.29~0.80** | 상품별 편차 큼 |
| 앙상블 모델 | **0.29~0.80** | 상품별 개별 최적화 필요 |
| 기상 포함 모델 | **TBD** | 기상요인 추가 후 측정 예정 |

**📌 설명력 낮은 원인 분석:**
- 일별 데이터의 높은 노이즈
- 외부 변수(날씨, 이벤트, 경쟁사) 미반영 → **기상 데이터로 일부 해결**
- 상품별 특성 차이 미반영

---

## 3. 모델링 (모델 선택 / Feature / 성능)

### 🔧 모델 진화 과정

```
[Stage 1] 기본 Random Forest
    ├─ n_estimators: 100
    ├─ 정확도: 62.50%
    └─ MAE: 0.85

[Stage 2] 고도화 Random Forest
    ├─ n_estimators: 200, max_depth: 10
    ├─ 시계열 피처 추가 (Lag, MA, Momentum)
    └─ 정확도: 62.61%

[Stage 3] 마케팅/재고 통합 모델
    ├─ 마케팅(spend, clicks, roas) + 재고(stock_received) 추가
    └─ 상품별 정확도: 48~67%

[Stage 4] 가중치 기반 모델
    ├─ 상관계수 기반 가중합(weighted_score)
    └─ 상품별 정확도: 59~75%

[Stage 5] 앙상블 모델 (RF + ARIMA)
    ├─ 동적 가중치 조합
    └─ 최종 정확도: 62~77%

[Stage 6] 기상요인 포함 모델 (NEW)
    ├─ 기온, 강수량, 폭염/폭우 피처 추가
    └─ 정확도: TBD (진행 예정)
```

### 📊 Feature Engineering

#### 기본 피처
| 피처명 | 설명 | 중요도 |
|--------|------|--------|
| `상품명/카테고리/브랜드` | 상품 식별 (Label Encoded) | 🔵 높음 |
| `month/day_of_week/is_weekend` | 시간 정보 | 🟡 중간 |

#### 시계열 피처
| 피처명 | 설명 | 계산 방식 |
|--------|------|----------|
| `수량_lag_1` | 전일/전주 판매량 | `shift(1)` |
| `수량_lag_7` | 1주 전 판매량 | `shift(7)` |
| `수량_MA3` | 3일 이동평균 | `rolling(3).mean()` |
| `주문_증가량` | 판매 변화량 | `lag_1 - lag_2` |
| `momentum` | 판매 가속도 | `lag_1 - lag_2` |

#### 외부 피처 (마케팅/재고)
| 피처명 | 데이터 소스 | 상관계수 (수량 기준) |
|--------|------------|---------------------|
| `spend` | 마케팅 | 0.50~0.77 |
| `clicks` | 마케팅 | 0.57~0.76 |
| `stock_received` | 재고 | 0.06~0.54 |
| `평점` | 피드백 | -0.25~0.31 |

#### 기상 피처 (신규)
| 피처명 | 설명 | 예상 영향 |
|--------|------|----------|
| `temp_max` / `주간_평균_최고기온` | 최고 기온 | 음료/아이스크림: 양의 상관 예상 |
| `temp_min` / `주간_평균_최저기온` | 최저 기온 | - |
| `temp_range` / `주간_평균_일교차` | 일교차 | 감기약 등 의약품: 양의 상관 예상 |
| `rain_pre` / `주간_평균_강수량` | 강수량 | 배달 수요: 양의 상관 예상 |
| `heatwave` / `주간_폭염_일수` | 폭염 여부 | 음료/냉동식품: 양의 상관 예상 |
| `heavy_rain` / `주간_폭우_일수` | 폭우 여부 | 우산/배달 수요: 양의 상관 예상 |

### 📈 최종 앙상블 모델 성능 (기상 미포함)

| 상품명 | MAE | R² | 정확도(%) | RF비중 |
|--------|-----|-----|-----------|--------|
| Pet Treats | 1.78 | 0.65 | **76.83** | 0.51 |
| Baby Wipes | 0.97 | 0.42 | **75.29** | 0.51 |
| Lotion | 0.96 | 0.80 | **74.86** | 0.50 |
| Pulses | 0.87 | 0.57 | **74.69** | 0.54 |
| Dish Soap | 1.69 | 0.66 | **73.61** | 0.43 |
| Cough Syrup | 1.23 | 0.71 | **73.29** | 0.57 |
| Vitamins | 1.47 | 0.48 | **72.01** | 0.55 |
| Orange Juice | 0.89 | 0.66 | **71.80** | 0.47 |
| Cat Food | 1.39 | 0.66 | **71.42** | 0.41 |
| Toilet Cleaner | 1.61 | 0.29 | **62.05** | 0.78 |

**📌 평균 정확도: 72.58%** (목표 70% 달성 ✅)

---

## 4. 운영 (UI, MLOps, DB, Network VF)

### 🚧 현재 상태: **개발 단계 (운영 미구현)**

현재는 Jupyter Notebook 기반 분석 단계이며, 운영 환경은 아직 구축되지 않았습니다.

### 📋 향후 운영 아키텍처 제안

#### (1) UI/대시보드
```
┌─────────────────────────────────────────────────────────────────┐
│                    Dashboard (Streamlit/Dash)                    │
├─────────────────────────────────────────────────────────────────┤
│  📊 수요 예측    📦 재고 현황    📈 마케팅    🌤️ 기상 영향    │
│  ┌───────────┐   ┌───────────┐   ┌───────────┐   ┌───────────┐ │
│  │ 주간 예측 │   │ 권장 주문 │   │ ROAS 추이 │   │ 기온-수요 │ │
│  │ 상품별    │   │ 품절 위험 │   │ 클릭→전환 │   │ 강수-배달 │ │
│  └───────────┘   └───────────┘   └───────────┘   └───────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

**추천 기술 스택:**
- **Streamlit** (빠른 프로토타이핑)
- **Plotly/Altair** (인터랙티브 시각화)
- **FastAPI** (백엔드 API)

#### (2) MLOps 파이프라인
```
[데이터 수집] → [전처리] → [모델 학습] → [평가] → [배포] → [모니터링]
     │              │            │           │          │           │
  Airflow       Pandas      scikit-learn   MLflow    Docker     Grafana
  +기상API                                  /W&B      /K8s      /Prometheus
```

**제안 도구:**
| 영역 | 도구 | 용도 |
|------|------|------|
| 워크플로우 | **Airflow** | 일/주간 배치 스케줄링 |
| 기상 데이터 | **OpenWeatherMap API** | 실시간 기상 수집 |
| 실험 추적 | **MLflow** | 모델 버전 관리, 파라미터 추적 |
| 모델 서빙 | **FastAPI + Docker** | REST API 배포 |
| 모니터링 | **Prometheus + Grafana** | 성능 모니터링 |

#### (3) Database 설계
```sql
-- 주요 테이블 구조 제안
┌────────────────────┐    ┌────────────────────┐
│     orders         │    │     products       │
├────────────────────┤    ├────────────────────┤
│ order_id (PK)      │    │ product_id (PK)    │
│ customer_id (FK)   │    │ product_name       │
│ order_date         │    │ category           │
│ total_amount       │    │ brand              │
└────────────────────┘    └────────────────────┘
         │                         │
         └─────────┬───────────────┘
                   ▼
         ┌────────────────────┐
         │   predictions      │  ← 예측 결과 저장
         ├────────────────────┤
         │ prediction_id (PK) │
         │ product_id (FK)    │
         │ week_start_date    │
         │ predicted_qty      │
         │ confidence         │
         │ created_at         │
         └────────────────────┘

         ┌────────────────────┐
         │   weather_data     │  ← 기상 데이터 저장 (NEW)
         ├────────────────────┤
         │ weather_id (PK)    │
         │ region             │
         │ date               │
         │ temp_max           │
         │ temp_min           │
         │ rainfall           │
         │ heatwave_flag      │
         └────────────────────┘
```

**추천 DB:**
- **PostgreSQL** (분석 쿼리 최적화)
- **TimescaleDB** (시계열 데이터 특화)

#### (4) Network/Validation Flow
```
[외부 데이터 소스]        [기상 API]
      │                      │
      ▼ (API / SFTP)         ▼ (REST API)
┌─────────────────────────────────────┐
│            Data Lake                │  ← Raw 데이터 저장 (S3/GCS)
└────────────────┬────────────────────┘
                 │
                 ▼ (Data Validation)
┌─────────────────────────────────────┐
│         Great Expectations          │  ← 스키마/값 검증
└────────────────┬────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────┐
│           ML Pipeline               │  ← 모델 학습/예측
└────────────────┬────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────┐
│            Dashboard                │  ← 결과 시각화
└─────────────────────────────────────┘
```

---

## 5. 현 상황까지의 Demo

### ✅ 완료된 작업

| 단계 | 내용 | 산출물 |
|------|------|--------|
| **1. 데이터 수집** | 7개 원본 CSV + 기상 2개 CSV 로드 | - |
| **2. 데이터 병합** | 주문+상품+고객+배송+피드백 통합 | `blinkit_final_data.csv` |
| **3. 일별 집계** | 시계열 피처 생성 (Lag, MA) | `blinkit_daily_data.csv` |
| **4. 주별 집계** | 노이즈 감소, 주간 패턴 분석 | `blinkit_weekly_data.csv` |
| **5. 마케팅 통합** | spend, clicks, roas 결합 | - |
| **6. 재고 통합** | stock_received, damaged_stock 결합 | - |
| **7. 기상 통합** | 기온, 강수량, 폭염/폭우 결합 | `blinkit_with_weather.csv` |
| **8. 상관분석** | Top 10 상품별 변수 중요도 분석 | `top_10_correlation_analysis.csv` |
| **9. 모델링** | RF, ARIMA, 앙상블 | `blinkit_final_ensemble_report.csv` |
| **10. 재고 계획** | 주간 권장 주문량 산출 | `weekly_inventory_plan.csv` |

### 📊 최종 산출물 요약

#### (1) 앙상블 모델 성능 리포트
```
📁 blinkit_final_ensemble_report.csv
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 10개 상품별 예측 성능
• 평균 정확도: 72.58%
• 최고 성능: Pet Treats (76.83%)
• 최저 성능: Toilet Cleaner (62.05%)
```

#### (2) 주간 재고 계획 리포트
```
📁 weekly_inventory_plan.csv
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
| 상품명      | 예측수요 | 안전재고 | 권장주문량 | 품절위험도 |
|------------|---------|---------|-----------|----------|
| Lotion     | 9.18    | 1.58    | 7         | 높음      |
| Cat Food   | 7.80    | 2.29    | 7         | 높음      |
| Pet Treats | 5.81    | 2.94    | 6         | 높음      |
| ...        | ...     | ...     | ...       | ...      |
```

#### (3) 상품별 상관관계 분석
```
📁 top_10_correlation_analysis.csv
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 수량 vs 마케팅(spend/clicks): 0.50~0.77 (강한 양의 상관)
• 수량 vs 재고(stock_received): 0.06~0.54 (상품별 편차)
• 수량 vs 평점: -0.25~0.31 (약한 상관)
```

#### (4) 기상 포함 데이터 (신규)
```
📁 blinkit_with_weather.csv
📁 blinkit_weekly_product_weather.csv
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 일별 기상 정보: 최고/최저 기온, 강수량, 폭염/폭우
• 주간 기상 집계: 평균 기온, 평균 강수량, 폭염/폭우 일수
• 지역별 기상 매칭 완료
```

### 🎬 Demo 시나리오

```
[Demo Flow]

1️⃣ 데이터 현황 확인
   └─ 5,000건 주문 / 100개 상품 / 87주 분석 기간
   └─ 기상 데이터: 5,002건 일별, 4,986건 주간

2️⃣ 상관분석 시각화
   └─ 마케팅 지출(spend) ↔ 판매량 상관관계 확인
   └─ 입고량(stock_received) ↔ 판매량 관계
   └─ 기온/강수량 ↔ 판매량 관계 (NEW)

3️⃣ 모델 성능 비교
   └─ 일별 vs 주별 모델 (주별이 2.28%p 우수)
   └─ 단일 RF vs 앙상블 (앙상블이 우수)
   └─ 기상 미포함 vs 포함 (비교 예정)

4️⃣ 예측 결과 확인
   └─ Top 10 상품 다음 주 예측 수요
   └─ 상품별 정확도 및 신뢰구간

5️⃣ 재고 계획 산출
   └─ 안전재고 = 예측오차(MAE) × 안전계수
   └─ 권장주문량 = 예측수요 + 안전재고 - 현재고
   └─ 품절위험도 분류 (높음/중간/낮음)
```

### 📌 향후 개선 방향

| 영역 | 현재 | 개선 방향 |
|------|------|----------|
| **데이터** | 7개 CSV + 기상 2개 | 실시간 DB 연동 + 기상 API |
| **모델** | 정적 학습 | 주간 재학습 자동화 |
| **피처** | 마케팅/재고 | 기상요인 포함 모델링 |
| **예측** | 수동 실행 | API 서빙 |
| **시각화** | Jupyter 그래프 | 인터랙티브 대시보드 |
| **알림** | 없음 | 품절 위험 + 기상 이상 알림 |

---

## 📎 부록: 파일 구조

```
blinkit-data-analysis/
├── data/
│   ├── blinkit_orders.csv
│   ├── blinkit_order_items.csv
│   ├── blinkit_products.csv
│   ├── blinkit_customers.csv
│   ├── blinkit_delivery_performance.csv
│   ├── blinkit_customer_feedback.csv
│   ├── blinkit_inventory.csv
│   ├── blinkit_marketing_performance.csv
│   └── merged_data/
│       ├── blinkit_daily_data.csv
│       ├── blinkit_final_data.csv
│       └── blinkit_weekly_data.csv
├── blinkit_final_data.csv
├── blinkit_final_ensemble_report.csv
├── blinkit_weekly_product_analysis.csv
├── weekly_inventory_plan.csv
├── top_10_correlation_analysis.csv
├── data_preprocessing.ipynb
├── weather_modeling.ipynb (NEW - 기상 모델링)
├── 전체_프로세스.md
└── 프로젝트_종합_보고서.md (이 문서)
```

---

*문서 작성일: 2025-12-29*
*버전: 1.0*

